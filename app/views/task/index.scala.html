@import helper._
@(tasks: List[Task], taskForm: Form[models.Task])(implicit request: RequestHeader, messagesProvider: MessagesProvider)

@main("Todo List") {
    <div class="container py-4">
        <!-- Header Section -->
        <div class="row mb-4 align-items-center">
            <div class="col-md-6">
                <h1 class="display-5 mb-0">
                    <i class="bi bi-check2-square me-2"></i>Todo List
                    <span class="badge bg-primary ms-2"><i class="bi bi-list-check me-1"></i>@tasks.size task(s)</span>
                </h1>
            </div>
            <div class="col-md-2 text-end">
                <a href="@routes.DashboardController.index" class="btn btn-info w-100">
                    <i class="bi bi-graph-up me-1"></i> View Dashboard
                </a>
            </div>
            <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input id="taskSearch" class="form-control" type="text" placeholder="Search tasks..." onkeyup="filterTasks()">
                </div>
            </div>
        </div>

        <!-- Tasks Table Card -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white py-3">
                <h5 class="card-title mb-0"><i class="bi bi-list-task me-2"></i>Your Tasks</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0" id="tasksTable">
                        <thead class="table-light">
                            <tr>
                                <th scope="col" class="ps-4"><i class="bi bi-hash me-1"></i>ID</th>
                                <th scope="col"><i class="bi bi-card-text me-1"></i>Name</th>
                                <th scope="col"><i class="bi bi-chat-left-text me-1"></i>Comments</th>
                                <th scope="col"><i class="bi bi-tags me-1"></i>Labels</th>
                                <th scope="col"><i class="bi bi-check2-circle me-1"></i>Status</th>
                                <th scope="col" class="text-end pe-4"><i class="bi bi-gear me-1"></i>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for(task <- tasks) {
                                <tr>
                                    <td class="ps-4">@task.id</td>
                                    <td>@task.name</td>
                                    <td>@task.comments</td>
                                    <td>
                                        @for(label <- task.labels) {
                                            <span class="badge bg-info me-1">
                                                <i class="bi bi-tag-fill me-1"></i>@label
                                            </span>
                                        }
                                    </td>
                                    <td>
                                        @if(task.completed) {
                                            <span class="badge bg-success" title="Completed">
                                                <i class="bi bi-check-circle-fill me-1"></i>Completed
                                            </span>
                                        } else {
                                            <span class="badge bg-secondary" title="Not completed">
                                                <i class="bi bi-hourglass-split me-1"></i>Pending
                                            </span>
                                        }
                                    </td>
                                    <td class="text-end pe-4">
                                        <form action="@routes.TaskController.edit(task.id.getOrElse(""))" method="POST" style="display:inline;">
                                            <button type="submit" class="btn btn-sm btn-outline-primary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit Task">
                                                <i class="bi bi-pencil-square"></i>
                                            </button>
                                        </form>
                                        <form action="@routes.TaskController.delete(task.id.getOrElse(""))" method="POST" style="display:inline;">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete Task">
                                                <i class="bi bi-trash-fill"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Add Task Form Card -->
        <div class="card shadow-sm">
            <div class="card-header bg-white py-3">
                <h5 class="card-title mb-0"><i class="bi bi-plus-circle me-2"></i>Add New Task</h5>
            </div>
            <div class="card-body">
                @form(routes.TaskController.create, Symbol("class") -> "needs-validation") {
                    <div class="row g-3">
                        <div class="col-md-6">
                            @inputText(taskForm("name"), 
                                Symbol("_label") -> "Task Name",
                                Symbol("_placeholder") -> "Enter task name",
                                Symbol("class") -> "form-control",
                                Symbol("_showConstraints") -> false,
                                Symbol("_icon") -> "bi-card-text"
                            )
                        </div>
                        <div class="col-md-6">
                            @inputText(taskForm("labels"),
                                Symbol("_label") -> "Labels",
                                Symbol("_placeholder") -> "Enter labels (comma-separated)",
                                Symbol("class") -> "form-control",
                                Symbol("value") -> taskForm("labels").value.getOrElse(""),
                                Symbol("_showConstraints") -> false,
                                Symbol("_icon") -> "bi-tags"
                            )
                        </div>
                        <div class="col-12">
                            @inputText(taskForm("comments"),
                                Symbol("_label") -> "Comments",
                                Symbol("_placeholder") -> "Enter comments",
                                Symbol("class") -> "form-control",
                                Symbol("_showConstraints") -> false,
                                Symbol("_icon") -> "bi-chat-left-text"
                            )
                        </div>
                        <div class="col-12">
                            <div class="form-check">
                                @checkbox(taskForm("completed"),
                                    Symbol("_label") -> "Mark as completed",
                                    Symbol("class") -> "form-check-input",
                                    Symbol("_showConstraints") -> false
                                )
                            </div>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-plus-circle me-1"></i>Create Task
                            </button>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    <script>
        // Bootstrap tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Filter tasks with debounce
        let timeout = null;
        function filterTasks() {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                var input = document.getElementById('taskSearch');
                var filter = input.value.toLowerCase();
                var table = document.getElementById('tasksTable');
                var trs = table.getElementsByTagName('tr');
                
                for (var i = 1; i < trs.length; i++) {
                    var tds = trs[i].getElementsByTagName('td');
                    var show = false;
                    for (var j = 0; j < tds.length; j++) {
                        if (tds[j].textContent.toLowerCase().indexOf(filter) > -1) {
                            show = true;
                            break;
                        }
                    }
                    trs[i].style.display = show ? '' : 'none';
                }
            }, 300);
        }
    </script>
}
