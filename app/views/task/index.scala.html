@import helper._
@(tasks: List[Task], taskForm: Form[models.Task])(implicit request: RequestHeader, messagesProvider: MessagesProvider)

@main("Todo List") {
    <div class="row mb-3">
      <div class="col-md-8">
        <h2>@tasks.size task(s)</h2>
      </div>
      <div class="col-md-4 text-end">
        <input id="taskSearch" class="form-control" type="text" placeholder="Search tasks..." onkeyup="filterTasks()">
      </div>
    </div>

    <table class="table table-striped table-hover table-bordered" id="tasksTable">
      <thead class="table-dark">
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Name</th>
          <th scope="col">Comments</th>
          <th scope="col">Completed</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        @tasks.map { task =>
            <tr>
                <td>@task.id</td>
                <td>@task.name</td>
                <td>@task.comments</td>
                <td>
                  @if(task.completed) {
                    <span class="badge bg-success" title="Completed">Yes</span>
                  } else {
                    <span class="badge bg-secondary" title="Not completed">No</span>
                  }
                </td>
                <td>
                  <form action="@routes.TaskController.edit(task.id.getOrElse("") )" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-sm btn-primary" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit Task">
                      <i class="bi bi-pencil"></i> Edit
                    </button>
                  </form>
                  <form action="@routes.TaskController.delete(task.id.getOrElse("") )" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-sm btn-danger" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete Task">
                      <i class="bi bi-trash"></i> Delete
                    </button>
                  </form>
                </td>
            </tr>
        }
      </tbody>
    </table>

    <h2 id="addTaskForm">Add a new task</h2>
    @form(routes.TaskController.create) {
        @inputText(taskForm("name"), Symbol("_label") -> "Task Name", Symbol("_placeholder") -> "Enter task name")
        @inputText(taskForm("comments"), Symbol("_label") -> "Comments", Symbol("_placeholder") -> "Enter comments")
        @checkbox(taskForm("completed"), Symbol("_label") -> "Completed", Symbol("_help") -> "")
        <input type="submit" value="Create" class="btn btn-primary">
    }

    <script>
      // Bootstrap tooltips
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
      // Filter tasks
      function filterTasks() {
        var input = document.getElementById('taskSearch');
        var filter = input.value.toLowerCase();
        var table = document.getElementById('tasksTable');
        var trs = table.getElementsByTagName('tr');
        for (var i = 1; i < trs.length; i++) {
          var tds = trs[i].getElementsByTagName('td');
          var show = false;
          for (var j = 0; j < tds.length; j++) {
            if (tds[j].textContent.toLowerCase().indexOf(filter) > -1) {
              show = true;
              break;
            }
          }
          trs[i].style.display = show ? '' : 'none';
        }
      }
    </script>
}
